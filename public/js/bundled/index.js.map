{"mappings":"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","sources":["public/js/leaflet.js","public/js/alert.js","public/js/login.js","public/js/updateSetting.js","public/js/stripe.js","public/js/index.js"],"sourcesContent":["/* eslint-disable */\r\n\r\nexport const displayMap = (locations) => {\r\n  var map = L.map('map', { zoomControl: false });\r\n\r\n  var greenIcon = L.icon({\r\n    iconUrl: '/img/pin.png',\r\n    iconSize: [32, 40], // size of the icon\r\n    iconAnchor: [16, 45], // point of the icon which will correspond to marker's location\r\n    popupAnchor: [0, -50], // point from which the popup should open relative to the iconAnchor\r\n  });\r\n\r\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n    attribution:\r\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n    crossOrigin: '',\r\n  }).addTo(map);\r\n\r\n  const points = [];\r\n  locations.forEach((loc) => {\r\n    points.push([loc.coordinates[1], loc.coordinates[0]]);\r\n    L.marker([loc.coordinates[1], loc.coordinates[0]], { icon: greenIcon })\r\n      .addTo(map)\r\n      .bindPopup(`<p>Day ${loc.day}: ${loc.description}</p>`, {\r\n        autoClose: false,\r\n      })\r\n      .openPopup();\r\n  });\r\n\r\n  const bounds = L.latLngBounds(points).pad(0.5);\r\n  map.fitBounds(bounds);\r\n\r\n  map.scrollWheelZoom.disable();\r\n};\r\n","export const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n\r\n  if (el) el.remove();\r\n};\r\n\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const html = `\r\n  <div class=\"alert alert--${type}\">${msg}</div>\r\n  `;\r\n\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', html);\r\n\r\n  window.setTimeout(hideAlert, 3000);\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alert';\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'POST',\r\n      url: '/api/v1/users/login',\r\n      data: {\r\n        email,\r\n        password,\r\n      },\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', 'Logged in successfully!');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'GET',\r\n      url: '/api/v1/users/logout',\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      // true force to reload from server not from browser cache\r\n      location.reload(true);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', 'Error logging out, Try again.');\r\n  }\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alert';\r\n\r\nexport const updateData = async (data, type) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'PATCH',\r\n      url: `/api/v1/users/${\r\n        type === 'password' ? 'updatePassword' : 'updateMe'\r\n      }`,\r\n      data,\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', `${type.toUpperCase()} updated successfully!`);\r\n      window.setTimeout(() => {\r\n        location.reload(true);\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    // console.log(err);\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alert';\r\n\r\nconst stripe = Stripe(\r\n  'pk_test_51Me5DpGo5ykfujlCXT83asPLszD4NT2iLuPmRHxRosmlQ1yQoCNrI6UkQaUvD83z48bSZ96LrPNUde15XJbrD1ky006NLM98Dz'\r\n);\r\n\r\nexport const bookTour = async (tourId) => {\r\n  try {\r\n    // 1) get checkout session from the API\r\n    const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\r\n\r\n    // console.log(session);\r\n\r\n    // 2) create checkout form + charge credit card\r\n    // await stripe.redirectToCheckout({\r\n    //   sessionId: session.data.session.id,\r\n    // });\r\n    window.location.replace(session.data.session.url);\r\n  } catch (err) {\r\n    console.error(err);\r\n    showAlert('error', err);\r\n  }\r\n};\r\n","import '@babel/polyfill';\nimport { displayMap } from './leaflet';\nimport { login, logout } from './login';\nimport { updateData } from './updateSetting';\nimport { bookTour } from './stripe';\n\n// DOM ELEMENTS\nconst map = document.getElementById('map');\nconst form = document.querySelector('.form--login');\nconst formUpdate = document.querySelector('.form-user-data');\nconst formUpdatePassword = document.querySelector('.form-user-password');\nconst logoutBtn = document.querySelector('.nav__el--logout');\nconst bookBtn = document.querySelector('#book-tour');\n\n// DELEGATION\nif (map) {\n  const locations = JSON.parse(map.dataset.locations);\n  displayMap(locations);\n}\n\nif (form)\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const email = document.getElementById('email').value;\n    const password = document.getElementById('password').value;\n    login(email, password);\n  });\n\nif (formUpdate)\n  formUpdate.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const form = new FormData(formUpdate);\n    updateData(form, 'data');\n  });\n\nif (formUpdatePassword)\n  formUpdatePassword.addEventListener('submit', async (e) => {\n    e.preventDefault();\n\n    const btn = document.querySelector('.btn--save-password');\n\n    btn.textContent = 'Updating...';\n    const currentPassword = document.querySelector('#password-current').value;\n    const password = document.querySelector('#password').value;\n    const passwordConfirm = document.querySelector('#password-confirm').value;\n    await updateData(\n      { currentPassword, password, passwordConfirm },\n      'password'\n    );\n\n    document.querySelector('#password-current').value = '';\n    document.querySelector('#password').value = '';\n    document.querySelector('#password-confirm').value = '';\n    btn.textContent = 'SAVE PASSWORD';\n  });\n\nif (logoutBtn) logoutBtn.addEventListener('click', logout);\n\nif (bookBtn)\n  bookBtn.addEventListener('click', (e) => {\n    e.target.textContent = 'Processing...';\n    const { tourId } = e.target.dataset;\n    bookTour(tourId);\n  });\n"],"names":["$b65541e07a62170e$export$4c5dd147b21b9176","locations","map","L","zoomControl","greenIcon","icon","iconUrl","iconSize","iconAnchor","popupAnchor","tileLayer","attribution","crossOrigin","addTo","points","forEach","loc","push","coordinates","marker","bindPopup","day","description","autoClose","openPopup","bounds","latLngBounds","pad","fitBounds","scrollWheelZoom","disable","$e9c91518574fdb31$export$516836c6a9dfc573","el","document","querySelector","remove","$e9c91518574fdb31$export$de026b00723010c1","type","msg","html","insertAdjacentHTML","window","setTimeout","$bf5b431e6a69fea8$export$596d806903d1f59e","async","email","password","$parcel$interopDefault","$cnf0l$axios","method","url","data","status","location","assign","err","response","message","$f10a946384e2fe45$export$3bf0495508a61ee","toUpperCase","reload","$9fd71c92b6f885af$export$8d5bdbf26681c0c2","Stripe","tourId","session","replace","console","error","$407eccdc61ba7a94$var$map","getElementById","$407eccdc61ba7a94$var$form","$407eccdc61ba7a94$var$formUpdate","$407eccdc61ba7a94$var$formUpdatePassword","$407eccdc61ba7a94$var$logoutBtn","$407eccdc61ba7a94$var$bookBtn","JSON","parse","dataset","addEventListener","e","preventDefault","value","form","FormData","btn","textContent","currentPassword","passwordConfirm","target"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}